# üïâÔ∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –°–æ—Å—Ç–æ—è–Ω–∏—è

## –ü—Ä–æ–±–ª–µ–º–∞
**"–ö—Ç–æ –≤ –ª–µ—Å, –∫—Ç–æ –ø–æ–¥ —Ä–æ–≤–∞"** - —Ä–∞–∑–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã —Ö–æ–¥–æ–≤ –≤ —á–∞—Ç–µ –∏ –Ω–∞ –∏–≥—Ä–æ–≤–æ–º –ø–æ–ª–µ.

### –ü—Ä–∏—á–∏–Ω–∞
–î–≤–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (`ChatBot` –∏ `GameScreen`) –æ–±–Ω–æ–≤–ª—è–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ:
- **GameScreen**: –±—Ä–æ—Å–æ–∫ –∫—É–±–∏–∫–∞ ‚Üí `updatePlayerInStorage` ‚Üí `needsReport: true`
- **ChatBot**: –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ ‚Üí `markReportCompleted` ‚Üí `needsReport: false`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è, —Ä–∞–∑–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö

## –†–µ—à–µ–Ω–∏–µ

### 1. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –°–æ—Å—Ç–æ—è–Ω–∏—è
–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `updatePlayerState()` –≤ `lib/apollo-drizzle-client.ts`:

```typescript
// –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä–æ–∫–∞
export const updatePlayerState = (updates: Partial<Player>) => {
  const currentPlayer = currentPlayerVar();
  if (!currentPlayer) return;
  
  const updatedPlayer = { ...currentPlayer, ...updates };
  updatePlayerInStorage(updatedPlayer);
};
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### GameScreen
- **–ë—ã–ª–æ**: `updatePlayerInStorage(updatedPlayer)`
- **–°—Ç–∞–ª–æ**: `updatePlayerState(updatedPlayer)`

#### ChatBot  
- **–ë—ã–ª–æ**: `updatePlayerInStorage(updatedPlayer)`
- **–°—Ç–∞–ª–æ**: `updatePlayerState(updatedPlayer)`

#### markReportCompleted
- **–ë—ã–ª–æ**: –ü—Ä—è–º–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `currentPlayerVar`
- **–°—Ç–∞–ª–æ**: `updatePlayerState({ needsReport: false })`

### 3. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è:

```javascript
console.log('[Apollo] updatePlayerState: –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ', {
  from: currentPlayer,
  updates,
  to: updatedPlayer
});
```

## –û–∂–∏–¥–∞–µ–º–æ–µ –ü–æ–≤–µ–¥–µ–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ë—Ä–æ—Å–æ–∫ –ö—É–±–∏–∫–∞
1. **GameScreen**: –ë—Ä–æ—Å–æ–∫ ‚Üí `updatePlayerState({ needsReport: true })`
2. **ChatBot**: useEffect ‚Üí "üìù –í—Ä–µ–º—è –¥–ª—è –æ—Ç—á–µ—Ç–∞ –æ –ø–ª–∞–Ω–µ X"
3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: ‚úÖ –û–±–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤–∏–¥—è—Ç `needsReport: true`

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û—Ç–ø—Ä–∞–≤–∫–∞ –û—Ç—á–µ—Ç–∞
1. **ChatBot**: –û—Ç—á–µ—Ç ‚Üí `markReportCompleted()` ‚Üí `updatePlayerState({ needsReport: false })`
2. **GameScreen**: useEffect ‚Üí "üé≤ –ì–æ—Ç–æ–≤—ã –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ö–æ–¥—É"
3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: ‚úÖ –û–±–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤–∏–¥—è—Ç `needsReport: false`

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –í –ö–æ–Ω—Å–æ–ª–∏ –ë—Ä–∞—É–∑–µ—Ä–∞
–ò—â–∏—Ç–µ –ª–æ–≥–∏:
- `[Apollo] updatePlayerState: –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ`
- `[ChatBot] useEffect: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å`
- `[ChatBot] –¢—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç—á–µ—Ç –¥–ª—è –ø–ª–∞–Ω–∞: X`
- `[Apollo] markReportCompleted: —Å–±—Ä–∞—Å—ã–≤–∞–µ–º needsReport`

### –í–∏–∑—É–∞–ª—å–Ω–∞—è –ü—Ä–æ–≤–µ—Ä–∫–∞
1. –ë—Ä–æ—Å—å—Ç–µ –∫—É–±–∏–∫ ‚Üí –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—á–µ—Ç–µ –ò –≤ —á–∞—Ç–µ, –ò –Ω–∞ –∏–≥—Ä–æ–≤–æ–º –ø–æ–ª–µ
2. –ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç—á–µ—Ç ‚Üí –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –∫—É–±–∏–∫ –ò –≤ —á–∞—Ç–µ, –ò –Ω–∞ –∏–≥—Ä–æ–≤–æ–º –ø–æ–ª–µ
3. –°—Ç–∞—Ç—É—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –≤–µ–∑–¥–µ

## –ü—Ä–∏–Ω—Ü–∏–ø "–ï–¥–∏–Ω—ã–π –ò—Å—Ç–æ—á–Ω–∏–∫ –ò—Å—Ç–∏–Ω—ã"
–¢–µ–ø–µ—Ä—å –≤—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä–æ–∫–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ `updatePlayerState()`, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏.

**üôè –û–º –®–∞–Ω—Ç–∏. –ï–¥–∏–Ω—Å—Ç–≤–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è - –æ—Å–Ω–æ–≤–∞ –≥–∞—Ä–º–æ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.** 