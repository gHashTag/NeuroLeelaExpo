---
description: 
globs: 
alwaysApply: false
---
# üïâÔ∏è –¢–µ–∫—É—â–∞—è –ó–∞–¥–∞—á–∞: üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–ê–Ø –†–ï–û–†–ì–ê–ù–ò–ó–ê–¶–ò–Ø - –ü–ï–†–ï–ù–û–° –ë–ò–ó–ù–ï–°-–õ–û–ì–ò–ö–ò –í INNGEST

## üéØ **–°–¢–ê–¢–£–°: ‚è≥ –ü–†–û–ï–ö–¢–ò–†–û–í–ê–ù–ò–ï –ê–†–•–ò–¢–ï–ö–¢–£–†–´**

### üß† **–§–∏–ª–æ—Å–æ—Ñ–∏—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ –†–µ—à–µ–Ω–∏—è**
> *"–ò—Å—Ç–∏–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç–¥–µ–ª—è–µ—Ç —Å—É—â–Ω–æ—Å—Ç—å –æ—Ç –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ - —ç—Ç–æ —Å—É—â–Ω–æ—Å—Ç—å, UI - –ª–∏—à—å –ø—Ä–æ—è–≤–ª–µ–Ω–∏–µ."*

**–ü–†–ò–ù–Ø–¢–û–ï –†–ï–®–ï–ù–ò–ï:** –ü—Ä–µ–∫—Ä–∞—â–∞–µ–º –æ—Ç–ª–∞–¥–∫—É UI –∏ –ø–µ—Ä–µ–Ω–æ—Å–∏–º **–í–°–Æ** –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ Inngest-—Ñ—É–Ω–∫—Ü–∏–∏.

### üìã **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ü—Ä–æ–±–ª–µ–º–∞**
–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–º–µ—à–∏–≤–∞–µ—Ç:
- ‚ùå –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö (ChatBot, GameService)
- ‚ùå –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã processGameStep() –∏–∑ UI
- ‚ùå –°–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–≥—Ä–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π
- ‚ùå –°–ª–æ–∂–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É UI –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π

### üèóÔ∏è **–¶–ï–õ–ï–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê (Event-Driven —Å Inngest)**

#### **üì§ UI –°–ª–æ–π (–¢–æ–ª—å–∫–æ –°–æ–±—ã—Ç–∏—è)**
```typescript
// UI –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è, –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ª–æ–≥–∏–∫—É
inngest.send('game.dice.roll', { userId, roll })
inngest.send('game.report.submit', { userId, report, planNumber })
inngest.send('game.player.create', { userId })
```

#### **‚öôÔ∏è Inngest –§—É–Ω–∫—Ü–∏–∏ (–í—Å—è –ë–∏–∑–Ω–µ—Å-–õ–æ–≥–∏–∫–∞)**
```typescript
// 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –±—Ä–æ—Å–∫–∞ –∫—É–±–∏–∫–∞
export const processDiceRoll = inngest.createFunction(
  { id: 'game-dice-roll' },
  { event: 'game.dice.roll' },
  async ({ event, step }) => {
    // –í—Å—è –ª–æ–≥–∏–∫–∞ GameService.processGameStep()
    // + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Supabase
    // + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  }
)

// 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—á–µ—Ç–æ–≤
export const processReport = inngest.createFunction(
  { id: 'game-report-process' },
  { event: 'game.report.submit' },
  async ({ event, step }) => {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—á–µ—Ç–∞
    // + AI –∞–Ω–∞–ª–∏–∑ (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
    // + —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫—É–±–∏–∫–∞
  }
)

// 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–∫–∞
export const initializePlayer = inngest.createFunction(
  { id: 'game-player-init' },
  { event: 'game.player.create' },
  async ({ event, step }) => {
    // –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
    // + –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  }
)
```

#### **üìä –†–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ (Apollo Client)**
```typescript
// UI —Ä–µ–∞–≥–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
const { currentPlayer } = useApolloDrizzle()
// Inngest –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
```

### ‚úÖ **–ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò**

#### **–≠—Ç–∞–ø 1: üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Inngest Infrastructure**
- ‚úèÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Inngest SDK
- ‚úèÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ Inngest –∫–ª–∏–µ–Ω—Ç–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úèÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –¥–ª—è Inngest
- ‚úèÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (Inngest Dev Server)

#### **–≠—Ç–∞–ø 2: üì¶ –°–æ–∑–¥–∞–Ω–∏–µ Core Inngest Functions**
- ‚úèÔ∏è `processDiceRoll` - –º–∏–≥—Ä–∞—Ü–∏—è –∏–∑ GameService.processGameStep()
- ‚úèÔ∏è `processReport` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—á–µ—Ç–æ–≤ –∏–≥—Ä–æ–∫–æ–≤
- ‚úèÔ∏è `initializePlayer` - —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä–æ–∫–∞
- ‚úèÔ∏è `updatePlayerState` - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

#### **–≠—Ç–∞–ø 3: üîÑ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ UI Event Dispatching**
- ‚úèÔ∏è –ó–∞–º–µ–Ω–∞ –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –Ω–∞ —Å–æ–±—ã—Ç–∏—è Inngest –≤ ChatBot
- ‚úèÔ∏è –£–ø—Ä–æ—â–µ–Ω–∏–µ handleNewDiceRoll() –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏—è
- ‚úèÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ –∏–∑ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úèÔ∏è –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è Apollo –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

#### **–≠—Ç–∞–ø 4: üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –í–∞–ª–∏–¥–∞—Ü–∏—è**
- ‚úèÔ∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
- ‚úèÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úèÔ∏è –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É UI –∏ Inngest
- ‚úèÔ∏è Performance —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### **–≠—Ç–∞–ø 5: üöÄ –û—á–∏—Å—Ç–∫–∞ Legacy Code**
- ‚úèÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏
- ‚úèÔ∏è –£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úèÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- ‚úèÔ∏è –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### üéØ **–ü–ï–†–í–´–ô –ê–ö–¢–ò–í–ù–´–ô –®–ê–≥: ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Inngest Infrastructure**

**–ù–∞—á–∏–Ω–∞–µ–º —Å:**
1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `inngest` npm –ø–∞–∫–µ—Ç–∞
2. –°–æ–∑–¥–∞–Ω–∏–µ `inngest/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Inngest –∫–ª–∏–µ–Ω—Ç–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---
*–û–º –®–∞–Ω—Ç–∏. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ —Å–ª—É–∂–∏—Ç—å —Ü–µ–ª–∏, –∞ –Ω–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –µ–π.* üèóÔ∏èüôè
